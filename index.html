<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0" />
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.0/css/bootstrap.min.css" />
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.0/js/bootstrap.min.js"></script>
		<link href="https://fonts.googleapis.com/css?family=Comfortaa" rel="stylesheet">
		<style>
      .vertical-center {
        min-height: 100vh; 
        display: flex;
        align-items: center;
      }

			#info {
				font-family: 'Comfortaa', cursive;
			}
    
			.form {
        max-height: 0vh;
        overflow: hidden;
        transition: all 2s;
			}

      #info:hover > .form { 
        max-height: 100vh;
        transition: all 2s;
      }

			#about {
				font-family: 'Comfortaa', cursive;
			}

      .pos-f-t {
      }

      #output {
        max-height: 100vh;
        margin-bottom: 5vh;
        display: hidden;
        text-align: center;
      }

		</style>
	</head>
	<body class="bg-dark" id="top">

		<div class="pos-f-t">
      <nav class="navbar navbar-dark bg-dark fixed-top">
        <div style="width: 10vw;">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggleExternalContent" aria-controls="navbarToggleExternalContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button><br />
				<div class="collapse" id="navbarToggleExternalContent" style="float: left;">
					<div class="bg-dark p-4 ">
						<h4 class="align-left nav-item"><a class="text-white" href="#top">top</a></h4>
						<span><a class="text-white" href="#about">about</a></span><br/>
						<span><a class="text-white" href="#columns">results</a></span><br/>
						<span><a id="mute" class="text-white" href="#">mute</a></span>
					</div>
				</div>
        </div>
      </nav>
    </div>

    <div class="vertical-center">
      <div class="container text-light" id="info">
        <div class="row justify-content-center">
          <h1 style="font-size: 7em">Mood</h1>
        </div>

          <div class="form" id="frm">
            <div class="form-group row justify-content-center">
              <div class="col-sm-4">
                <label for="sel1">Search by:</label>
                <select class="form-control" id="sel1">
                  <option value="artist">Artist</option>
                  <option value="track">Song</option>
                </select>
                <label class="col-form-label" style="text-align: right;">Search:</label>
                <input name="search" type="text" id="input" class="form-control"></input>
                <div style="padding-top: 15px;"><input type="submit" class="btn btn-primary" id="submit" value="Submit"></button></div>
              </div>
            </div>
          </div>
          <div class="row justify-content-center">
            <h1 style="font-size: 7em">Music</h1>
          </div>
        </div>
      </div>
      
      <div class="row" id="columns">
      </div>

		<div class="container" id="output">
    </div>

		<div class="container text-light bg-secondary" style="min-width: 100vw" name="about" id="about">
			<div class="row justify-content-center">
				<div class="container" id="cards">
				<h1 style="font-size: 7em; margin-top: 3%;text-align: center;">About</h1>
          <div style="margin: 5%;">
            <h2>Synesthesia is a peculiar medical condition that combines senses together.</h2><br/>
            
            A person may:<br/>
            <ul>
              <li>Hear a sound and see a color</li>
              <li>Smell something and hear a sound</li>
              <li>See a word and taste a flavor</li>
            </ul>
            This project is meant to be a representation of what Synthesia might look like to those who have it.<br/>
            <ol> 
                <li>Enter a song or playlist</li>
                <li>We calculate a color for each song</li>
                <li>Visualize your data!</li>
            </ol>
	    <br/>
	    The color for each song is represented in HSL form.<br/><br/>
        
      <table class="table table-hover table-dark">
        <thead>
          <tr>
            <th scope="col">Attr</th>
            <th scope="col">Range</th>
            <th scope="col">Description</th>
            <th scope="col">Calculation</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">Hue</th>
            <td>0-360</td>
            <td>The actual color (ex. green, red, blue)<br/><br/>Based on <u><a style="color: #CCC;" href="http://whs-blogs.co.uk/teaching/hearing-colour-synesthesia-musical-composition/" target="_blank" rel="noopener">notes</a></u> by Olivier Messiaen, a composer with synesthesia</td>
            <td>Based on key (ex. C, F, Bb) and modality (major or minor)</td>
          </tr>
          <tr>
            <th scope="row">Saturation</th>
            <td>0-100%</td>
            <td>The vibrance of the color<br/><br/>0% is grey</td>
            <td>Based on valence<br/><br/>lower valence = less positive song = lower saturation</td>
          </tr>
          <tr>
            <th scope="row">Lightness</th>
            <td>0-100%</td>
            <td>How light a song in a major key is or how dark a song in a minor key is<br/><br/>0% is black and 100% is white</td>
            <td>Based on energy<br/><br/>higher energy = less light for major or less dark for minor</td>
          </tr>
        </tbody>
      </table><br/>
            
	    This project uses an express backend, a bootstrap frontend, and the Spotify api.<br/><br>
            <strong><em><a style="color: #454545" href="https://github.com/iyves/mood-music" target="_blank" rel="noopener">Click here to see the github repository for this project.</a></em></strong>
          </div>
					<div class="row">
						<div class="col-md">
							<div class="card text-dark">
								<div class="card-body">
                  <h2 class="card-title">Steven Borrego</h2>
                  <hr/> 
                  <p>A computer science major at Portland State University.</p>
                  <p>I enjoy classic film and literature, guitar/bass/drums/keyboards, audio engineering, LP collecting, cycling, and technology.</p>
                  <p>
                    <a style="color: #555;" href="https://www.linkedin.com/in/steven-borrego-b60107181/" target="_blank" rel="noopener">linkedin</a>&emsp;
                      <a style="color: #555;" href="https://github.com/stevengborrego" target="_blank" rel="noopener">github</a>
                  </p>
								</div>
							</div>
						</div>

						<div class="col-md">
								<div class="card text-dark">
									<div class="card-body">
										<h2 class="card-title">Yves Wienecke</h2>
                    <hr/> 
										<p>A dedicated third year student pursuing a double major in computer science and Russian at Portland State University looking for industry experience in software engineering.</p>
                    <p>Study abroad in Korea and Kazakhstan adapt me to excel in foreign situations and cooperate with diverse backgrounds.</p>
                    <p>
                      <a style="color: #555;" href="https://www.linkedin.com/in/yves-wienecke/" target="_blank" rel="noopener">linkedin</a>&emsp;
                      <a style="color: #555;" href="https://github.com/iyves" target="_blank" rel="noopener">github</a>
                    </p>
									</div>
							</div>
						</div>
					</div>
					</div>
			</div>
      <br/><br/><br/>
		</div>
	</body>

	<script>
    var muted = false;
    var scrollOver = false;
    var currSlide = 1;
    var maxSlide = 0;

    var results = false;
    
    var changeSlide = function(index) {
      if (results) {
	      $('.colorSlide:nth-child(' + currSlide +')').css('display', 'none');
	      if ($('.colorSlide:nth-child(' + currSlide +') audio').attr('src') != 'null')
		$('.colorSlide:nth-child(' + currSlide +') audio')[0].pause();
	      currSlide = index;
	      if (currSlide > maxSlide){
		currSlide = 1;
	      }
	      $('.colorSlide:nth-child(' + currSlide +')').css('display', 'block');
	      if (!muted && $('.colorSlide:nth-child(' + currSlide +') audio').attr('src') != 'null')
		$('.colorSlide:nth-child(' + currSlide +') audio')[0].play();
	}
    }

    setInterval(function(){
      if (!scrollOver)
        changeSlide(currSlide +1)
    }, 5000); 

    $('#mute').click(function(e) {
      muted = !muted;
      if ($('.colorSlide:nth-child(' + currSlide +') audio').attr('src') != 'null' && results) {
        if (muted)
        {
          $('.colorSlide:nth-child(' + currSlide +') audio')[0].pause();
        } else { 
          $('.colorSlide:nth-child(' + currSlide +') audio')[0].play();
        }
      }
      e.preventDefault(); 
    });
    var showResult = function(data) {
        console.log(data);
        maxSlide = data.length;
        currSlide = 1;  
        results = true;

        $('#output').html('');
        // For each song that spotify found (up to 10), put the song color and details into a carousel slide!
        for (var i = 0; i < maxSlide; i += 1) {
          $('#output').append($('<div></div>')
            .addClass('colorSlide')
            .css({
              'margin': '0 auto',
              'position': 'relative',
              'text-align': 'center',
              'display': 'none',
              'height': '50vh',
              'width': '50%',
              'overflow': 'hidden',
              'background-color': 'hsl(' + data[i].color['h'] + ', '
                                       + data[i].color['s'] + '%, '
                                       + data[i].color['l'] + '%)'
            }) 
            // This is for the song details
            .each(function() {
              $(this).append($('<div></div>')
                      .addClass('colorCaption')
                      .css({
                        'background-color': '#404040',
                        'font-family': "'Comfortaa', cursive",
                        'width': '100%',
                        'padding': '2%',
                        'position': 'absolute',
                        'bottom': '0' 
                      })
              .each (function() {
                $(this).append($('<h2></h2>')
                        .css({
                          'text-align': 'center',
                          'color': '#DEDEDE'
                        })
                // Song name
                .each(function() {
                  $(this).append($('<a></a>')
                          .attr({
                          target: '_blank',
                          rel: 'noopener',
                          href: data[i].url
                          })
                          .css({
                            'color': '#DEDEDE'
                          })
                          .text(data[i].name))
                          .append($('<hr/>'))
                }))
                .append($('<div></div>')
                        .css({
                          'width': '100%',
                          'display': 'flex',
                          'flex-direction': 'row',
                          'justify-content': 'center'
                        })
                        .each(function() {
                          $(this).append($('<div></div>')
                                 .css({
                                   'margin-right': '5%'
                                 })
                                 // Album art for song
                                 .each(function() {
                                   $(this).append($('<img>')
                                   .attr({'src': data[i].image})
                                   .css({
                                     'border-radius': '3%'
                                   }))
                                 })
                          ).append($('<div></div>')
                                   .css({
                                     'text-align': 'left'
                                   })
                                   // Album details
                                   .each(function() {
                                      $(this).append($('<p></p>')
                                             .css({
                                               'color': '#999'
                                             })
                                             .html(
                                              'Album:&nbsp;&emsp;&emsp;&emsp;' + data[i].album +
                                              '<br/>Artists:&nbsp;&emsp;&emsp;&emsp;' + data[i].artists.join(', ') +
                                              '<br/>Popularity:&nbsp;&emsp;' + data[i].popularity
                                             ))
                                   })
                           )  
                        })
                )
                .append($('<audio></audio>', {
                          'preload': 'auto',
                          'src': data[i].sound
                        }))
              }))
            })
          );
        }

        // Display first slide upon receiving search result
        $('.colorSlide:nth-child(1)').css('display', 'block');
        if (!muted && $('.colorSlide:nth-child(' + currSlide +') audio').attr('src') != 'null')
          $('.colorSlide:nth-child(1) audio')[0].play();
        
        var c ='';
        for(var i = 0; i < data.length; i += 1) {
          c += '<div class="col-sm resultColumn" style="background-color: hsl('
            + data[i].color['h'] + ','
            + data[i].color['s'] + '%, '
            + data[i].color['l'] + '%'
            + ')"></div>';
        }
       $('#columns').html(c);
       $('#columns').css("min-height", "50vw").css("min-width", "100vw").css("margin-bottom", "5vh");
       $('#output').css("min-height", "20vw").css("min-width", "30vw");
       $('#columns').css('display', 'float');
       $('#output').css("display", 'float');
        $('html, body').animate({
          scrollTop: $("#output").offset().top - 300
    	}, 1000);
        
        $('.resultColumn').hover(function(e) {
          scrollOver = true;
          var num = $('.resultColumn').index(this) + 1;
          changeSlide(num);
        }, function() { scrollOver = false; });
      };

    var noResult = function(data) {
        console.log('no results');

        $('#columns').css("min-height", "50vw").css("min-width", "100vw").css("margin", "0").css("margin-bottom", "5vh").css("background-color", "rgb(217,83,79)");
        $('#columns').html('<div class="container text-light" id="info"><div class="row justify-content-center" style="margin-top: 20vh"><h1 style="font-size: 5em">No Results</h1></div>');
        $('#columns').css('display', 'float');
        $('#output').html('');
        $('html, body').animate({
          scrollTop: $("#columns").offset().top
    	}, 1000);
        return;
    };

		$('#submit').on('click', function(event){
      console.log("in click event");
			$.ajax({
        'url' : '/submit',
				'type': 'POST',
				'data':  {option: $('#sel1').val(), input: $('#input').val() },
        'success': showResult
        });

        if(results === false) {
          noResult();
        }
        results = false;
    });

    $('#input').on('keyup', function(event){
      console.log('in keyup event');
      if(event.which === 13){
        $('#submit').click();
      }
    });
	</script>
</html>
